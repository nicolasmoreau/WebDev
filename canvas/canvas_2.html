<html>
<head>
	<script>
	    var context;
	    var canvas;
    
	    var screen = {
			width : 640,
			height : 400			
		};
		
		function Sprite(){
			this.x = 0; 
			this.y = 0;	
			this.isFull = false;	
			this.color = 'red';
		}
		
		Sprite.prototype.plot = function(){
			return true;
		}
		
		Sprite.prototype.setColor = function(){
			context.strokeStyle = this.color;
			context.fillStyle = this.color;			
		}
		
		Square.prototype = new Sprite;
		
		function Square(){
			this.width = 20;
			this.height = this.width;
		}
		
		Square.prototype.plot = function(){
			context.beginPath();		
			this.setColor();	
			context.rect(this.x, this.y, this.height, this.width);
			if(!this.isFull)
				context.stroke();
			else context.fill();
		}	
		
		Circle.prototype = new Sprite();
		
		function Circle(){
			this.radius = 20;			
		}
		
		Circle.prototype.plot = function(){
			context.beginPath();
			this.setColor();			
			context.arc(this.x, this.y, this.radius, 0, Math.PI*2);
			context.stroke();
		}
		
		Player.prototype = new Sprite();
		
		function Player(){
			this.width = 15;
			this.height = 15;
			this.speed = 5;
			this.x = 200;
			this.y = 200;
			this.color = 'blue';			
		}
		
		Player.prototype.plot = function(){
			this.setColor();
			context.beginPath();
			context.rect(this.x, this.y, this.width, this.height);
			context.fill();
		}
        
        Player.prototype.setX = function(x){
            if(x + this.width < screen.width && x > 0)
                this.x = x;
        }
        
        Player.prototype.setY = function(y){
            if(y + this.height < screen.heigth && this.y > 0)
                this.y = y;
        }
		
		function doKeyDown(evt, sprite){
			switch (evt.keyCode) {
				case 38:  /* Up arrow was pressed */
					if (sprite.y - sprite.speed > 0){
						sprite.y -= sprite.speed;
					}
					break;
				case 40:  /* Down arrow was pressed */
					if (sprite.y + sprite.speed < screen.height){
						sprite.y += sprite.speed;
					}
					break;
				case 37:  /* Left arrow was pressed */
					if (sprite.x - sprite.speed > 0){
						sprite.x -= sprite.speed;
					}
					break;
				case 39:  /* Right arrow was pressed */
					if (sprite.x + sprite.speed < screen.width){
						sprite.x += sprite.speed;
					}
					break;
			}
		}
		
		var square = new Square;	
		var square2 = new Square;
		square2.y = 100;
		square2.isFull = true;
		var circle = new Circle;
		circle.y = 50;
		var player = new Player;		
		var sprites = new Array(square, square2, circle, player);
		
		/*
		function deplacement(sprite){
			double angle = atan2(target.y-position.y, target.x-position.x);
			double xVel = speed*cos(angle);
			double yVel = speed*sin(angle);	
			sprite.x = sprite.x + xVel;
			sprite.y = sprite.y + yVel;
		}*/


		function init(){
			canvas = document.getElementById("canvas");
			context = canvas.getContext("2d");
			return setInterval(animate, 10);
		}
		
		function plotSprites(){
			for(var i = 0; i<sprites.length; i++){
				sprites[i].plot();
			}
		}
        
        function mousemove(evt){
            player.setX(evt.clientX);
        }
		
		function animate(){             
			context.clearRect(0, 0, screen.width, screen.height);
			// draw
			
			if(square.x + square.width < screen.width){
				square.x = square.x+1;
				square2.x = square2.x +1;
				circle.x = circle.x +1;
			}
			plotSprites();
			
		}   		
		window.addEventListener('keydown',function(evt){doKeyDown(evt, player)},false);
        window.addEventListener('mousemove',mousemove,false);
		window.onload=function(){
			init();
		}
	</script>
</head>
<body>
	<canvas id="canvas" style="border : solid;" width="640" height="400" />
</body>
</html>
